<!--

Copyright 2025 Esri

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied. See the License for the specific language governing
permissions and limitations under the License.

-->
<UserControl x:Class="SdmaConnector.ProjectExplorerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"   
						 xmlns:helpers="clr-namespace:SdmaConnector.Helpers"
             xmlns:ui="clr-namespace:SdmaConnector"

             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300"
             d:DataContext="{Binding Path=ui.ProjectExplorerViewModel}">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/ArcGIS.Desktop.Framework;component\Themes\Default.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" LastChildFill="true" KeyboardNavigation.TabNavigation="Local" Height="30">
            <TextBlock Text="{Binding Heading}" Style="{DynamicResource Esri_TextBlockDockPaneHeader}">
                <TextBlock.ToolTip>
                    <WrapPanel Orientation="Vertical" MaxWidth="300">
                        <TextBlock Text="{Binding Heading}" TextWrapping="Wrap"/>
                    </WrapPanel>
                </TextBlock.ToolTip>
      </TextBlock>
        </DockPanel>

        <Grid Grid.Row="1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="2*" MinHeight="100" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="1*" MinHeight="50" />
            </Grid.RowDefinitions>

            <!-- Status Bar -->

            <Border Grid.Row="0" 
			        BorderBrush="{DynamicResource Esri_BorderBrush}" BorderThickness="0,0,0,1" 
			        Padding="8,4">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Ellipse Grid.Column="0" Width="8" Height="8" Margin="0,0,8,0" VerticalAlignment="Center">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#FF28A745" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding LoginStatus}" Value="Not logged in">
                                        <Setter Property="Fill" Value="#FFDC3545" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding LoginStatus}" Value="Logging in...">
                                        <Setter Property="Fill" Value="#FFFFC107" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding LoginStatus}" Value="Re-authenticating...">
                                        <Setter Property="Fill" Value="#FFFFC107" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Grid.Column="1" Text="{Binding LoginStatus, StringFormat=Status: {0}}" 
					           Style="{DynamicResource Esri_TextBlockRegular}" 
					           VerticalAlignment="Center" />
                </Grid>
            </Border>

            <!-- Projects Header -->
            <Grid Grid.Row="1" HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"></ColumnDefinition>
                    <ColumnDefinition Width="Auto"></ColumnDefinition>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="SDMA Portal Connection:" Margin="5" 
				           Style="{DynamicResource Esri_TextBlockH6}" />
                <Button Grid.Column="1" Margin="5" HorizontalAlignment="Right" 
				        Command="{Binding CmdRefreshSdma}" 
				        Style="{DynamicResource Esri_Button}"
				        Content="Refresh"></Button>
            </Grid>
            <TreeView Grid.Row="2" ItemsSource="{Binding SdmaItems}" Margin="5" 
								VerticalAlignment="Stretch" 
								SelectedItemChanged="TreeView_SelectedItemChanged">
                <TreeView.ItemContainerStyle>
                    <Style TargetType="{x:Type TreeViewItem}">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}" />
                        <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}" />
                        <Setter Property="FontWeight" Value="Normal" />
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="FontWeight" Value="Bold" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TreeView.ItemContainerStyle>

                <TreeView.Resources>
                    <HierarchicalDataTemplate DataType="{x:Type helpers:SdmaProjectItem}" ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <Image Width="16" Height="16" Margin="3,0">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Setter Property="Source" Value="Images/ArcGISProject16.png" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                                <Setter Property="Source" Value="Images/ArcGISProjectOpenState16.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Text="{Binding Name}" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type helpers:SdmaAssetItem}" ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Download All Files" Click="DownloadAsset_Click" />
                                </ContextMenu>
                            </StackPanel.ContextMenu>
                            <Image Width="16" Height="16" Margin="3,0" Source="Images/STACAssetSelection16.png" />
                            <TextBlock Text="{Binding Name}" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <HierarchicalDataTemplate DataType="{x:Type helpers:SdmaFolderItem}" ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <Image Width="16" Height="16" Margin="3,0">
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Setter Property="Source" Value="Images/Folder16.png" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                                <Setter Property="Source" Value="Images/FolderOpenState16.png" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                            <TextBlock Text="{Binding Name}" />
                        </StackPanel>
                    </HierarchicalDataTemplate>
                    <DataTemplate DataType="{x:Type helpers:SdmaFileItem}">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Preview Image" Click="PreviewImage_Click" />
                                    <MenuItem Header="Download File" Click="DownloadFile_Click" />
                                    <Separator />
                                    <MenuItem Header="Add Reference to Feature Class/Table..." Command="{Binding AddReferenceCommand}" />
                                </ContextMenu>
                            </StackPanel.ContextMenu>
                            <Image Width="16" Height="16" Margin="3,0" Source="Images/FileImage16.png" />
                            <TextBlock Text="{Binding Name}" />
                        </StackPanel>
                    </DataTemplate>
                </TreeView.Resources>
            </TreeView>

            <!-- GridSplitter for resizing -->
            <GridSplitter Grid.Row="3" 
                          Height="5" 
                          HorizontalAlignment="Stretch" 
                          VerticalAlignment="Center"
                          Background="{DynamicResource Esri_BorderBrush}"
                          ShowsPreview="False" />

            <!-- Details Pane -->
            <DockPanel Grid.Row="4" LastChildFill="True">
                <TextBlock DockPanel.Dock="Top" Text="Details:" Margin="5" 
			               Style="{DynamicResource Esri_TextBlockH6}" />
                <ScrollViewer Margin="5" VerticalScrollBarVisibility="Auto">
                    <TextBlock Text="{Binding SelectedItemDetails}" 
				               Style="{DynamicResource Esri_TextBlockRegular}"
				               TextWrapping="Wrap"
				               FontFamily="Consolas"
				               Padding="8" />
                </ScrollViewer>
            </DockPanel>
        </Grid>
    </Grid>
</UserControl>
